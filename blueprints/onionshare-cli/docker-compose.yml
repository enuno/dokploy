services:
  onionshare:
    # OnionShare v2.6 - secure anonymous file sharing over Tor
    # Pinned by digest for reproducibility (updated: 2024-11-05)
    image: effraie/onionshare-cli@sha256:9bd888961d7887125220d655249a3712e1570b6263ba02271767e494e5b3741c
    restart: unless-stopped
    volumes:
      # Persistent Tor data for consistent .onion address
      - onionshare-tor:/root/.config/onionshare
      # Local filesystem directory for shared files (bind mount)
      # Users place files here to share, or receive files here
      - ${DATA_DIR:?Set local data directory path}:/shared
    # OnionShare CLI uses command-line arguments
    # Entrypoint is: onionshare-cli
    # Pass CLI args via ONIONSHARE_ARGS environment variable
    command: ${ONIONSHARE_ARGS:-/shared}
    networks:
      - onionshare-net
    # No Traefik labels - OnionShare uses Tor network (.onion addresses)
    # Access is via Tor Browser using the generated .onion URL
    healthcheck:
      test: ["CMD-SHELL", "pgrep -f 'onionshare-cli\\|tor' || exit 1"]
      interval: 60s
      timeout: 15s
      retries: 3
      start_period: 180s

volumes:
  onionshare-tor:
    driver: local

networks:
  onionshare-net:
    driver: bridge
