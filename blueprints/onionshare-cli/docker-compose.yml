services:
  onionshare:
    image: nikosch86/docker-onionshare:v2.6.1
    restart: unless-stopped
    volumes:
      # Persistent Tor data for consistent .onion address
      - onionshare-tor:/root/.config/onionshare
      # Local filesystem directory for shared files (bind mount)
      # Users place files here to share, or receive files here
      - ${DATA_DIR:?Set local data directory path}:/shared
    # OnionShare CLI uses command-line arguments
    # The entrypoint is: /usr/local/bin/onionshare-cli
    # Default CMD is: /shared
    command: ${ONIONSHARE_ARGS:-/shared}
    networks:
      - onionshare-net
    # No Traefik labels - OnionShare uses Tor network (.onion addresses)
    # Access is via Tor Browser using the generated .onion URL
    healthcheck:
      test: ["CMD-SHELL", "pgrep -f 'onionshare-cli\\|tor' || exit 1"]
      interval: 60s
      timeout: 15s
      retries: 3
      start_period: 180s

volumes:
  onionshare-tor:
    driver: local

networks:
  onionshare-net:
    driver: bridge
