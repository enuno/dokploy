# nostr-rs-relay - Nostr relay implementation in Rust
# https://github.com/scsibug/nostr-rs-relay

[variables]
# Relay domain (required)
relay_domain = "${domain}"

# Relay information
relay_name = ""
relay_description = ""
relay_pubkey = ""
relay_contact = ""

# Network configuration
relay_port = "8080"

# Limits configuration
messages_per_sec = "100"
max_event_bytes = "131072"
max_ws_message_bytes = "131072"

[[config.domains]]
serviceName = "nostr-relay"
port = 8080
host = "${relay_domain}"

[config.env]
# No environment variables needed - all configuration via config.toml

[[config.mounts]]
serviceName = "nostr-relay"
mountPath = "/usr/src/app/config.toml"
content = """
# nostr-rs-relay Configuration
# Auto-generated by Dokploy

# ===========================================
# Relay Information
# ===========================================
[info]
relay_url = "wss://${relay_domain}/"
name = "${relay_name}"
description = "${relay_description}"
pubkey = "${relay_pubkey}"
contact = "${relay_contact}"

# ===========================================
# Database Configuration
# ===========================================
[database]
data_directory = "/usr/src/app/db"
engine = "sqlite"
in_memory = false
min_conn = 4
max_conn = 8

# ===========================================
# Network Configuration
# ===========================================
[network]
port = ${relay_port}
address = "0.0.0.0"
ping_interval = 300

# ===========================================
# Event Limits
# ===========================================
[limits]
messages_per_sec = ${messages_per_sec}
subscriptions_per_min = 60
db_conns_per_client = 4
max_blocking_threads = 16
max_event_bytes = ${max_event_bytes}
max_ws_message_bytes = ${max_ws_message_bytes}
max_ws_frame_bytes = 1048576
broadcast_buffer = 16384
event_persist_buffer = 4096
limit_scrapers = false

# ===========================================
# Future Event Handling
# ===========================================
[options]
reject_future_seconds = 1800

# ===========================================
# Logging
# ===========================================
[logging]
folder_path = "/usr/src/app/logs"
file_prefix = "nostr-relay"

# ===========================================
# Authorization (Optional)
# Uncomment to enable whitelist or NIP-42 auth
# ===========================================
# [authorization]
# pubkey_whitelist = []
# nip42_auth = false
# nip42_dms = false

# ===========================================
# NIP-05 Verification (Optional)
# ===========================================
[verified_users]
mode = "passive"
verify_expiration = "7 days"
verify_update_frequency = "24 hours"
max_consecutive_failures = 20

# ===========================================
# Pay-to-Relay (Optional)
# Uncomment to enable monetization
# ===========================================
# [pay_to_relay]
# enabled = false
# processor = "LNBits"
# admission_cost = 1000
# cost_per_event = 0
# node_url = "https://lnbits.example.com"
# api_secret = ""
# sign_ups = true
"""
