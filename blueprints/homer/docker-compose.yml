services:
  # =============================================================================
  # Homer - A very simple static homepage for your server
  # Static dashboard with YAML configuration
  # =============================================================================
  homer:
    image: b4bz/homer:v24.05.1
    restart: always
    volumes:
      # Persist configuration files and assets
      - homer-assets:/www/assets
    environment:
      # =======================================================================
      # Initialization
      # =======================================================================
      INIT_ASSETS: ${INIT_ASSETS:-1}

      # =======================================================================
      # Server Configuration
      # =======================================================================
      PORT: ${PORT:-8080}

    networks:
      - homer-net
      - dokploy-network
    labels:
      # =======================================================================
      # Traefik Routing Configuration
      # =======================================================================
      - "traefik.enable=true"
      - "traefik.http.routers.homer.rule=Host(`${HOMER_DOMAIN}`)"
      - "traefik.http.routers.homer.entrypoints=websecure"
      - "traefik.http.routers.homer.tls.certresolver=letsencrypt"

      # Security headers middleware
      - "traefik.http.routers.homer.middlewares=homer-security-headers@docker"
      - "traefik.http.middlewares.homer-security-headers.headers.stsSeconds=31536000"
      - "traefik.http.middlewares.homer-security-headers.headers.stsIncludeSubdomains=true"
      - "traefik.http.middlewares.homer-security-headers.headers.contentTypeNosniff=true"
      - "traefik.http.middlewares.homer-security-headers.headers.frameDeny=true"
      - "traefik.http.middlewares.homer-security-headers.headers.browserXssFilter=true"
      - "traefik.http.middlewares.homer-security-headers.headers.referrerPolicy=strict-origin-when-cross-origin"

      # Service configuration
      - "traefik.http.services.homer.loadbalancer.server.port=8080"
      - "traefik.docker.network=dokploy-network"
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s  # Fast-starting static server

# =============================================================================
# Volumes
# =============================================================================
volumes:
  homer-assets:
    driver: local

# =============================================================================
# Networks
# =============================================================================
networks:
  homer-net:
    driver: bridge
  dokploy-network:
    external: true
