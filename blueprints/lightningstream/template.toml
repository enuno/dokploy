# Lightning Stream - LMDB Replication for PowerDNS
# https://github.com/PowerDNS/lightningstream
#
# Near real-time synchronization of PowerDNS LMDB databases across instances
# using S3-compatible object storage (MinIO included, Cloudflare R2 optional).

[variables]
domain = "${domain}"
pdns_api_key = "${password:32}"
s3_access_key = "${password:20}"
s3_secret_key = "${password:40}"

# PowerDNS API subdomain
[[config.domains]]
serviceName = "authoritative"
port = 8081
host = "api.${domain}"

# Syncer status subdomain
[[config.domains]]
serviceName = "syncer"
port = 8500
host = "sync.${domain}"

# MinIO Console subdomain
[[config.domains]]
serviceName = "minio"
port = 9001
host = "s3.${domain}"

# MinIO API subdomain
[[config.domains]]
serviceName = "minio"
port = 9000
host = "s3-api.${domain}"

[config.env]
# =============================================================================
# Domain Configuration
# =============================================================================
DOMAIN = "${domain}"

# =============================================================================
# PowerDNS Configuration
# =============================================================================
PDNS_API_KEY = "${pdns_api_key}"

# DNS port (change if port 53 is in use)
# Common alternatives: 5353, 5300
DNS_PORT = "53"

# =============================================================================
# Lightning Stream Instance
# =============================================================================
# Unique identifier for this syncer (must be unique per deployment)
INSTANCE_ID = "instance-1"

# =============================================================================
# S3 Storage Configuration (MinIO default)
# =============================================================================
# For MinIO (included in this template):
S3_ENDPOINT = "http://minio:9000"
S3_BUCKET = "lightningstream"
S3_ACCESS_KEY = "${s3_access_key}"
S3_SECRET_KEY = "${s3_secret_key}"
S3_REGION = "us-east-1"

# =============================================================================
# Cloudflare R2 Configuration (Alternative)
# =============================================================================
# To use Cloudflare R2 instead of MinIO:
# 1. Remove the minio service from docker-compose.yml
# 2. Update the S3_ENDPOINT to your R2 endpoint:
#    S3_ENDPOINT = "https://<ACCOUNT_ID>.r2.cloudflarestorage.com"
# 3. Set R2 credentials:
#    S3_ACCESS_KEY = "<R2_ACCESS_KEY_ID>"
#    S3_SECRET_KEY = "<R2_SECRET_ACCESS_KEY>"
#    S3_REGION = "auto"
# =============================================================================
