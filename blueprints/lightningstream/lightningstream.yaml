# Lightning Stream Configuration
# https://github.com/PowerDNS/lightningstream
#
# Environment variables are expanded in this file using ${VAR} syntax

# Instance identifier (must be unique per syncer)
instance: "${INSTANCE_ID}"

# HTTP status server
http:
  address: ":8500"

# S3 storage configuration
storage:
  type: s3
  s3:
    endpoint: "${S3_ENDPOINT}"
    bucket: "${S3_BUCKET}"
    region: "${S3_REGION}"
    access_key: "${S3_ACCESS_KEY}"
    secret_key: "${S3_SECRET_KEY}"
    create_bucket: true
    # Use path-style URLs (required for MinIO)
    force_path_style: true

# LMDB database configuration
lmdbs:
  # PowerDNS main database
  main:
    path: /var/lib/powerdns/pdns.lmdb
    # Schema version tracking (required for PowerDNS)
    schema_track: true
    # Do not recurse into subdirectories
    options:
      no_subdir: true
      create: true

# Sweeper configuration (cleanup old snapshots)
sweeper:
  enabled: true
  interval: 6h
  retention: 8760h  # 1 year

# Storage cleanup configuration
storage_cleanup:
  enabled: true
  interval: 15m
  keep_duration: 24h
