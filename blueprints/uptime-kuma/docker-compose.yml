services:
  uptime-kuma:
    image: louislam/uptime-kuma:2
    restart: always
    volumes:
      - uptime-kuma-data:/app/data
    environment:
      # ===========================================
      # Domain Configuration
      # ===========================================
      UPTIME_KUMA_DOMAIN: ${DOMAIN:?Set your domain for Uptime Kuma}

      # ===========================================
      # Server Configuration
      # Port: Internal HTTP server port (default: 3001)
      # Host: Binding address (default: ::, all interfaces)
      # ===========================================
      UPTIME_KUMA_PORT: ${UPTIME_KUMA_PORT:-3001}
      UPTIME_KUMA_HOST: "::"

      # ===========================================
      # Timezone Configuration
      # Sets timezone for monitoring schedules and logs
      # ===========================================
      TZ: ${TZ:-UTC}

      # ===========================================
      # Cloudflare Tunnel (Optional)
      # Alternative to Traefik for exposing dashboard
      # Generate token: cloudflared tunnel token
      # ===========================================
      # UPTIME_KUMA_CLOUDFLARED_TOKEN: ${CLOUDFLARED_TOKEN:-}

      # ===========================================
      # Security Configuration (Optional)
      # ===========================================
      # UPTIME_KUMA_DISABLE_FRAME_SAMEORIGIN: "false"
      # UPTIME_KUMA_WS_ORIGIN_CHECK: "cors-like"

    networks:
      - uptime-kuma-net
      - dokploy-network
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.uptime-kuma.rule=Host(`${DOMAIN}`)"
      - "traefik.http.routers.uptime-kuma.entrypoints=websecure"
      - "traefik.http.routers.uptime-kuma.tls.certresolver=letsencrypt"
      - "traefik.http.routers.uptime-kuma.middlewares=uptime-kuma-security@docker"
      # Security headers middleware
      - "traefik.http.middlewares.uptime-kuma-security.headers.stsSeconds=31536000"
      - "traefik.http.middlewares.uptime-kuma-security.headers.stsIncludeSubdomains=true"
      - "traefik.http.middlewares.uptime-kuma-security.headers.contentTypeNosniff=true"
      - "traefik.http.middlewares.uptime-kuma-security.headers.browserXssFilter=true"
      - "traefik.http.middlewares.uptime-kuma-security.headers.referrerPolicy=strict-origin-when-cross-origin"
      - "traefik.http.services.uptime-kuma.loadbalancer.server.port=3001"
      - "traefik.docker.network=dokploy-network"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3001"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

volumes:
  uptime-kuma-data:
    driver: local

networks:
  uptime-kuma-net:
    driver: bridge
  dokploy-network:
    external: true
